

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Authors &#8212; Brightway Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/notebooks/BW25_for_dummies';</script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Installing anaconda" href="BW2_for_dummies.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">This website is in the early stages of development. No useful content is hosted here currently.</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    Brightway Learn Homepage
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="BW2_for_dummies.html">Installing anaconda</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">Authors</a></li>










</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/brightway-lca/jupyter-book-brightway-documentation/main?urlpath=tree/content/notebooks/BW25_for_dummies.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/brightway-lca/jupyter-book-brightway-documentation" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/notebooks/BW25_for_dummies.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Authors</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Authors</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introductory-note">Introductory note</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-of-a-project">1. Setup of a project</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-creating-a-new-project">1.1.a Creating a new project</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#b-use-an-existing-project">1.1.b Use an existing project</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#database-import-setup">2. Database import/setup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-biosphere-flows">2.1 Importing biosphere flows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-a-backend-database">2.2. Importing a backend database</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-importing-ecoinvent">2.2.a Importing ecoinvent</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database-selection-and-a-first-look-at-activities">2.3 Database selection and a first look at activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-a-foreground-dataset-from-excel">2.3 Importing a foreground dataset from Excel</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-database-creation">3. Manual database creation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lcia">4. LCIA</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#foreground-system">5. Foreground system</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-create-a-simple-product-system">5.1 How to create a simple product system?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bottle-production">5.2 Bottle production</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulating-an-exchange">6. Manipulating an exchange</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copying-and-deleting-activities">6.1 Copying and deleting activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-attempts-at-manipulating-an-exchange-s-keys-values">6.2 First attempts at manipulating an exchange’s keys/values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#substituting-an-exchange">6.3 Substituting an exchange</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#successfully-manipulating-an-exchange">6.4 Successfully manipulating an exchange</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-contribution-analysis">7. Basic contribution analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recalculation-of-the-inventory">7.1 Recalculation of the inventory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.2 Basic contribution analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-emissions-and-processes-by-name">7.3 Top emissions and processes by name</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-lca">8. Multi-LCA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manually-comparing-products">8.1 Manually comparing products</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-setups">8.2 Calculation setups</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlca">8.3 MLCA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation">9. Monte Carlo simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-information-in-brightway">Uncertainty information in Brightway</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-monte-carlo-simulation">Basic Monte Carlo simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="authors">
<h1>Authors<a class="headerlink" href="#authors" title="Permalink to this heading">#</a></h1>
<p>This notebook was authored by Max Koslowski and Alya Bolowich using excerpts from Max Koslowski’s <a class="reference external" href="https://github.com/maximikos/Brightway2_Intro/blob/master/BW2_tutorial.ipynb">Brightway2 tutorial</a>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introductory-note">
<h1>Introductory note<a class="headerlink" href="#introductory-note" title="Permalink to this heading">#</a></h1>
<p><a id='section0'></a>
This is a <a class="reference external" href="https://jupyter-notebook-beginner-guide.readthedocs.io/en/latest/what_is_jupyter.html">Jupyter Notebook</a> with the purpose of making you familiar with the basic Python-based <a class="reference external" href="https://documentation.brightway.dev/en/latest/index.html">Brightway25 LCA framework</a> and its various functionalities, all developed by Chris Mutel and colleagues.</p>
<p>This notebook is designed to get you started with creating your own project, setting up your database(s) (used as background systems) and simple foreground systems, performing your first impact assessments, analysing your results, and running Monte Carlo simulations in calculation setups.</p>
<p>Since Brightway2 builds on Python, a widely used programming language for scientific analysis, and can be installed easiest through the package and environment mangement system <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/"><em>conda</em></a>, we need to get either <a class="reference external" href="https://www.anaconda.com/">Anaconda</a>, an open source distribution for multiple languages including Python and R, or at least <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a>, the bootstrap version of Anaconda. The full Anaconda installation contains, among others, a terminal and an IDE (integrated development environment). And, good for us, it natively installs the setup for Jupyter Notebooks, through which we can work most effectively with Brightway2. Both Jupyter and Brightway can also be installed through <a class="reference external" href="https://jupyter.readthedocs.io/en/latest/install.html#new-to-python-and-jupyter"><em>pip</em></a>, but it may be a tad trickier.</p>
<p>For clarification: <em>conda</em> is, just like <em>pip</em>, a package and environment management system; the difference, however, is that “<em>pip</em> installs python packages within any environment; <em>conda</em> installs any package within conda environments.” (quote from <a class="reference external" href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/">here</a>)</p>
<br>
<hr class="docutils" />
<p><strong>Recommended prerequisites are:</strong></p>
<ul class="simple">
<li><p>having installed <a class="reference external" href="https://docs.brightway.dev/en/latest/content/installation/installation.html">Brightway25</a> + all relevant packages (make sure to do so in the correct virtual environment) and possibly even having had a first quick look at its <a class="reference external" href="https://docs.brightway.dev/en/latest/index.html">documentation</a>.
<ins></p></li>
<li><p>knowledge of the foundations of life cycle assessment. If you don’t have this knowledge (or simply need a refresher), have a look at the <a class="reference external" href="http://www.teaching.industrialecology.uni-freiburg.de/">online teaching resources</a> provided by the Industrial Ecology Freiburg Group, led by Stefan Pauliuk.</p></li>
<li><p>familiarity with any programming language - no Python-specific requirements, as most methods are quite intuitive and will be explained anyway. In case you are a total beginner, check <a class="reference external" href="https://github.com/PoutineAndRosti/Brightway-Seminar-2017/blob/master/Day%201%20AM/1%20-%20Python%20and%20notebook%20basics.ipynb">this</a> out :)</p></li>
</ul>
<br>
<hr class="docutils" />
<p><strong>For Jupyter newbies</strong></p>
<p>In a <a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/index.html">Jupyter notebook</a> everything is live and interactive. And, perhaps more interesting, markdown elements and actual code are mixed - and you can even include images, videos, and other formats. There are <a class="reference external" href="https://github.com/jupyter/jupyter/wiki/A-gallery-of-interesting-Jupyter-Notebooks">many</a>, <a class="reference external" href="https://rise.readthedocs.io/en/maint-5.5/index.html">many</a> things that you can do with such notebooks, and there are also many <a class="reference external" href="https://blog.dominodatalab.com/lesser-known-ways-of-using-notebooks/">cool</a> <a class="reference external" href="https://www.dataquest.io/blog/jupyter-notebook-tips-tricks-shortcuts/">tricks</a> as well as some <a class="reference external" href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions">extensions</a>.</p>
<p>To get you started, you might want to press the <code class="docutils literal notranslate"><span class="pre">h</span></code>-key, which gives you an overview of keyboard shortcuts. Then, you have markdown (richt text containing) cells and code cells: if you hover over and select any cell by clicking on it (notice the blue bar on the left of the cell; turns green when you are in edit mode, i.e. having clicked into the cell box) you can turn it into either a markdown one by pressing <code class="docutils literal notranslate"><span class="pre">m</span></code> or into a code cell by pressing <code class="docutils literal notranslate"><span class="pre">y</span></code>; there are other types, too, but they are not relevant for what we want to do. Click on a cell to select it or simply use the arrow keys to navigate. If you want to run a cell, simply press <code class="docutils literal notranslate"><span class="pre">shift+enter</span></code>. And if you want to insert an empty cell above or below the current one, simply press <code class="docutils literal notranslate"><span class="pre">a</span></code> or <code class="docutils literal notranslate"><span class="pre">b</span></code>. For changing the contents of a cell, either doubleclick a markdown cell or click a code cell; pressing <code class="docutils literal notranslate"><span class="pre">enter</span></code> works, too. You can exit a cell using <code class="docutils literal notranslate"><span class="pre">Esc</span></code> and can copy, cut, and paste cells when pressing the keys <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">v</span></code> when having selected a cell. As for the output of a command, note that clicking on it once makes it scroll-able, clicking on it twice results in hiding it.</p>
<p>You will notice further below that there are sometimes commands starting with <code class="docutils literal notranslate"><span class="pre">import</span></code>. These ones are needed to “import” the code of the respective package into the present code. For instance, by importing the Brightway2 package you enable the present notebook to use the Brightway2 functionalities. To have access to these packages, you need to download them first; otherwise you will receive an error message. You can download such packages in two ways: either in the notebook or in the terminal (make sure to be in the right virtual environment).</p>
<p>These are the absolute basics, but they are already more than what you need here.</p>
<br>
<hr class="docutils" />
<p><strong>Recap on LCA</strong></p>
<p>To make sure we are on the same page, let’s recapitulate the basics of LCA, expressed in a single formula (the notation may differ to the one that you are familiar with):</p>
<div class="math notranslate nohighlight">
\[h = CBA^{-1}f\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(A\)</span>… transaction matrix (dimensions <em>p x q</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(B\)</span>… environmental interventions matrix (dimensions <em>r x q</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(C\)</span>… characterisation matrix (dimensions <em>p x q</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(f\)</span>… final demand vector (dimensions <em>p x 1</em>)</p></li>
<li><p><span class="math notranslate nohighlight">\(h\)</span>… characterised inventory matrix (dimensions <em>1 x 1</em>)</p></li>
</ul>
<p>with the dimensions being:</p>
<ul class="simple">
<li><p><em>p</em>… number of products</p></li>
<li><p><em>q</em>… number of activities/processes</p></li>
<li><p><em>r</em>… number of elementary flows</p></li>
</ul>
<p>Specific parts of the above formula have distinct names. Since these names are also used in the Brightway2-framework, we will note them down here:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(f\)</span>… demand array</p></li>
<li><p><span class="math notranslate nohighlight">\(A{^-1}f\)</span>… supply array</p></li>
<li><p><span class="math notranslate nohighlight">\(BA{^-1}f\)</span>… inventory</p></li>
<li><p><span class="math notranslate nohighlight">\(CBA{^-1}f\)</span>… characterised inventory</p></li>
</ul>
<p>To not only get a single score per impact category, we can diagonalise the supply array (how this can be realised in the Brightway2-framework is not shown in this notebook) so that we can see the environmental impacts per process:</p>
<div class="math notranslate nohighlight">
\[h_{process} = CB~diag(A^{-1}f)\]</div>
<p>You can do the same for breaking down the total environmental impact to the stressors:</p>
<div class="math notranslate nohighlight">
\[h_{stressor} = C~diag(BA^{-1}f)\]</div>
<p>Another way of representing your results is to show the environmental stressors per activity for a specific impact category:</p>
<div class="math notranslate nohighlight">
\[h_{category} = diag(C)~B~diag(A^{-1}f)\]</div>
<br>
<hr class="docutils" />
<p><strong>The notebook is structured as follows:</strong></p>
<ol class="arabic simple">
<li><p><span class="xref myst">Setup of a project</span>: <em>How to set up a project to work in</em></p></li>
<li><p><span class="xref myst">Database import/setup</span>: <em>How to import a database and get it ready for use</em><br><br>
2.1 <span class="xref myst">Importing ecoinvent and Forwast</span><br>
2.2 <span class="xref myst">Database selection and a first look at activities</span><br>
2.3 <span class="xref myst">Importing a dataset from Excel</span><br><br></p></li>
<li><p><span class="xref myst">Manual database creation</span>: <em>How to manually create a database</em></p></li>
<li><p><span class="xref myst">LCIA</span>: <em>Basics of the LCIA calculations</em></p></li>
<li><p><span class="xref myst">Foreground system</span>: <em>How to set up a very simple product system and ways to explore BW2’s functionalities</em><br><br>
5.1 <span class="xref myst">Simple product system</span><br>
5.2 <span class="xref myst">Bottle production</span><br><br></p></li>
<li><p><span class="xref myst">Manipulating an exchange</span>: <em>How to manipulate an activity in multiple ways</em><br><br>
6.1 <span class="xref myst">Copying and deleting an activity</span><br>
6.2 <span class="xref myst">First attempts at manipulating an exchange’s keys/values</span><br>
6.3 <span class="xref myst">Substituting an exchange</span><br>
6.4 <span class="xref myst">Successfully manipulating an exchange</span><br><br></p></li>
<li><p><span class="xref myst">Basic contribution analysis</span>: <em>How to examine the LCA results</em><br><br>
7.1 <span class="xref myst">Recalculation of the inventory</span><br>
7.2 <span class="xref myst">Basic contribution analysis</span><br>
7.3 <span class="xref myst">Top emissions and processes by name</span><br><br></p></li>
<li><p><span class="xref myst">Multi-LCA</span>: <em>How to compare multiple alternatives across multiple impact categories simultaneously</em><br><br>
8.1 <span class="xref myst">Manually comparing products</span><br>
8.2 <span class="xref myst">Calculation setups</span><br>
8.3 <span class="xref myst">MLCA</span><br><br></p></li>
<li><p><span class="xref myst">Monte Carlo simulation</span>: <em>How to quantify uncertainties of the LCA result</em><br><br></p></li>
</ol>
<br>
<hr class="docutils" />
<p><strong>Outcomes - what are we going to learn?</strong></p>
<p>By completing this notebook (run it locally on your machine and don’t just read the code), we will:</p>
<ul class="simple">
<li><p>have understood the basics of the Brightway25 LCA framework</p></li>
<li><p>know how to import/generate/handle datasets in Brightway25</p></li>
<li><p>be able to run simple LCAs (both linearly and in parallel)</p></li>
<li><p>be able to analyse a product system and the results of an LCA</p></li>
<li><p>know the contirbution analysis of a product</p></li>
<li><p>be able to visualise data in form of tables and figures</p></li>
</ul>
<br>
<hr class="docutils" />
<p>Just for clarification, abbreviations used in the markdown cells of this notebook are:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Abbreviation(s)</p></th>
<th class="head"><p>Written out</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bw, BW25</p></td>
<td><p>Brightway25</p></td>
</tr>
<tr class="row-odd"><td><p>FU</p></td>
<td><p>Functional unit</p></td>
</tr>
<tr class="row-even"><td><p>LCA</p></td>
<td><p>Life cycle assessment</p></td>
</tr>
<tr class="row-odd"><td><p>LCI</p></td>
<td><p>Life cycle inventory</p></td>
</tr>
<tr class="row-even"><td><p>LCIA</p></td>
<td><p>Life cycle impact assessment</p></td>
</tr>
<tr class="row-odd"><td><p>EI</p></td>
<td><p>Ecoinvent</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p>So, that would be it what we’re up to do. But if you’re super keen then you might also be interested in checking out the <strong><a class="reference external" href="https://github.com/LCA-ActivityBrowser/activity-browser">Activity browser</a></strong> and <strong><a class="reference external" href="https://lcopt.readthedocs.io/en/latest/">LCOPT</a></strong>, both of which are essentially graphical user interfaces for BW25. The latter one can be used particularly for parametrised inventories (you’ll learn more about the basics of this later).</p>
<br>
<hr class="docutils" />
<p><a id='section1'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="setup-of-a-project">
<h1>1. Setup of a project<a class="headerlink" href="#setup-of-a-project" title="Permalink to this heading">#</a></h1>
<p>A project gets instantiated and relevant libraries/packages imported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages we&#39;ll need later on in this tutorial</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Import BW25 packages. You&#39;ll notice the packages are imported individually, unlike a one-and-done import with BW2.</span>
<span class="kn">import</span> <span class="nn">bw2data</span> <span class="k">as</span> <span class="nn">bd</span>
<span class="kn">import</span> <span class="nn">bw2io</span> <span class="k">as</span> <span class="nn">bi</span>
<span class="kn">import</span> <span class="nn">bw2calc</span> <span class="k">as</span> <span class="nn">bc</span>
<span class="kn">import</span> <span class="nn">bw2analyzer</span> <span class="k">as</span> <span class="nn">bwa</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Import packages we&#39;ll need later on in this tutorial</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;matplotlib&#39;
</pre></div>
</div>
</div>
</div>
<p>Let’s list the available projects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you&#39;re just starting out, this should only have &quot;default&quot; in it.</span>
<span class="c1"># Else, you&#39;ll see all the previous projects you&#39;ve worked on.</span>

<span class="n">bd</span><span class="o">.</span><span class="n">projects</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Brightway2 projects manager with 6 objects:
	bw25-tuto
	default
	ecoinvent391
	terra
	test
	test-from-new
Use `projects.report()` to get a report on all projects.
</pre></div>
</div>
</div>
</div>
<p>We can see where our projects are stored using the following command (info that’s good to know but not essential to run your LCA).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bd</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">dir</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PosixPath(&#39;/home/bolowich/.local/share/Brightway3/default.c21f969b5f03d33d43e04f8f136e7682&#39;)
</pre></div>
</div>
</div>
</div>
<section id="a-creating-a-new-project">
<h2>1.1.a Creating a new project<a class="headerlink" href="#a-creating-a-new-project" title="Permalink to this heading">#</a></h2>
<p>To create a new project, we need to set it up:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You need to set a project. Give it a name!</span>
<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;bw25-tuto&quot;</span>
<span class="n">bd</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">set_current</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Confirm that your project has been registered:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bd</span><span class="o">.</span><span class="n">projects</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Brightway2 projects manager with 6 objects:
	bw25-tuto
	default
	ecoinvent391
	terra
	test
	test-from-new
Use `projects.report()` to get a report on all projects.
</pre></div>
</div>
</div>
</div>
</section>
<section id="b-use-an-existing-project">
<h2>1.1.b Use an existing project<a class="headerlink" href="#b-use-an-existing-project" title="Permalink to this heading">#</a></h2>
<p>The code here is commented out to avoid any confusion with those starting a new project. If you already have a project, then uncomment this code and run the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your name variable should be the name of the project.</span>

<span class="c1">#name = &quot;project-i-want&quot;</span>
<span class="c1">#bd.projects.set_current(name)</span>
</pre></div>
</div>
</div>
</div>
<p>You <strong>must</strong> execute the bd.projects.set_current() command <strong><em>before</em></strong> importing the biosphere flows (or progressing further for that matter)!</p>
<p><a id='section2'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="database-import-setup">
<h1>2. Database import/setup<a class="headerlink" href="#database-import-setup" title="Permalink to this heading">#</a></h1>
<p><a id='section21'></a></p>
<section id="importing-biosphere-flows">
<h2>2.1 Importing biosphere flows<a class="headerlink" href="#importing-biosphere-flows" title="Permalink to this heading">#</a></h2>
<p>We will now add our first database to the project. Let’s see what databases we have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bd</span><span class="o">.</span><span class="n">projects</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Brightway2 projects manager with 6 objects:
	bw25-tuto
	default
	ecoinvent391
	terra
	test
	test-from-new
Use `projects.report()` to get a report on all projects.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bd</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">dir</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PosixPath(&#39;/home/bolowich/.local/share/Brightway3/bw25-tuto.45033c72&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If this is your first time using BW25, this should be an empty dictionary! </span>
<span class="n">bd</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Databases dictionary with 1 object(s):
	biosphere3
</pre></div>
</div>
</div>
</div>
<p>We will now import the biosphere matrix to our project.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If this is the first time you&#39;ve set up the project, you need to install the biosphere flows.</span>
<span class="c1"># You do not need to run this subsequent times.</span>

<span class="n">bi</span><span class="o">.</span><span class="n">bw2setup</span><span class="p">()</span> <span class="c1">## THIS YIELDS AN ERROR AT THE MOMENT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Biosphere database already present!!! No setup is needed
</pre></div>
</div>
</div>
</div>
<p><a id='section22'></a></p>
</section>
<section id="importing-a-backend-database">
<h2>2.2. Importing a backend database<a class="headerlink" href="#importing-a-backend-database" title="Permalink to this heading">#</a></h2>
<p><a id='section22a'></a></p>
<section id="a-importing-ecoinvent">
<h3>2.2.a Importing ecoinvent<a class="headerlink" href="#a-importing-ecoinvent" title="Permalink to this heading">#</a></h3>
<p>LCA draws on a lot of background data. Those can be found in numerous databases, for instance ecoinvent. We can check which databases are available in the current project with the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List the available databases.</span>
<span class="c1"># It is important that now you see the biosphere database!</span>
<span class="n">bd</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Databases dictionary with 1 object(s):
	biosphere3
</pre></div>
</div>
</div>
</div>
<p>If the list does not yet include the database we want, we can import it.
<br><br>As an example, we first import the ecoinvent cut-off database and check on some of the import’s statistics. You’ll need to have the path to your ecoinvent database and a name that you’ll use for it. The EI database will need to be <strong>unzipped</strong> and the the path should end at the <strong>datasets</strong> folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the path where your EI database is stored. </span>
<span class="c1"># Note that the EI database must be unzipped and the path should end at the datasets folder.</span>
<span class="n">ei_path</span> <span class="o">=</span> <span class="s2">&quot;/home/bolowich/Documents/dbs/ecoinvent 3.9.1_cutoff_ecoSpold02/datasets&quot;</span>

<span class="c1"># You will also need to give your database a name. This name will appear when you call bd.databases.</span>
<span class="c1"># Here, I am using EI v3.9.1 cutoff.</span>
<span class="n">ei_name</span> <span class="o">=</span> <span class="s2">&quot;ecoinvent-391-cutoff&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When we execute this cell, we will check if it&#39;s already been imported, and if not (else) we import it.</span>

<span class="k">if</span> <span class="n">ei_name</span> <span class="ow">in</span> <span class="n">bd</span><span class="o">.</span><span class="n">databases</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database has already been imported.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Go ahead and import:</span>
    <span class="n">ei_importer</span> <span class="o">=</span> <span class="n">bi</span><span class="o">.</span><span class="n">SingleOutputEcospold2Importer</span><span class="p">(</span><span class="n">ei_path</span><span class="p">,</span> <span class="n">ei_name</span><span class="p">)</span>
    <span class="c1"># Apply stragegies </span>
    <span class="n">ei_importer</span><span class="o">.</span><span class="n">apply_strategies</span><span class="p">()</span>
    <span class="c1"># We can get some statistics</span>
    <span class="n">ei_importer</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span>
    <span class="c1"># Now we will write the database into our project. </span>
    <span class="n">ei_importer</span><span class="o">.</span><span class="n">write_database</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting XML data from 21238 datasets
Extracted 21238 datasets in 27.16 seconds
Applying strategy: normalize_units
Applying strategy: update_ecoinvent_locations
Applying strategy: remove_zero_amount_coproducts
Applying strategy: remove_zero_amount_inputs_with_no_activity
Applying strategy: remove_unnamed_parameters
Applying strategy: es2_assign_only_product_with_amount_as_reference_product
Applying strategy: assign_single_product_as_activity
Applying strategy: create_composite_code
Applying strategy: drop_unspecified_subcategories
Applying strategy: fix_ecoinvent_flows_pre35
Applying strategy: drop_temporary_outdated_biosphere_flows
Applying strategy: link_biosphere_by_flow_uuid
Applying strategy: link_internal_technosphere_by_composite_code
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/bolowich/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/strategies/ecospold2.py:997: UserWarning: Skipping migration &#39;fix-ecoinvent-flows-pre-35&#39; because it isn&#39;t installed
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Applying strategy: delete_exchanges_missing_activity
Applying strategy: delete_ghost_exchanges
Applying strategy: remove_uncertainty_from_negative_loss_exchanges
Applying strategy: fix_unreasonably_high_lognormal_uncertainties
Applying strategy: set_lognormal_loc_value
Applying strategy: convert_activity_parameters_to_list
Applying strategy: add_cpc_classification_from_single_reference_product
Applying strategy: delete_none_synonyms
Applying strategy: update_social_flows_in_older_consequential
Applied 22 strategies in 1.93 seconds
21238 datasets
674593 exchanges
407351 unlinked exchanges
  Type biosphere: 996 unique unlinked exchanges
Not able to determine geocollections for all datasets. This database is not ready for regionalization.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">ei_importer</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># Now we will write the database into our project. </span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">ei_importer</span><span class="o">.</span><span class="n">write_database</span><span class="p">()</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/importers/base_lci.py:277,</span> in <span class="ni">LCIImporter.write_database</span><span class="nt">(self, data, delete_existing, backend, activate_parameters, db_name, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_database_parameters</span><span class="p">(</span><span class="n">activate_parameters</span><span class="p">,</span> <span class="n">delete_existing</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span> <span class="n">existing</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">277</span> <span class="n">db</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">279</span> <span class="k">if</span> <span class="n">activate_parameters</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_write_activity_parameters</span><span class="p">(</span><span class="n">activity_parameters</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/project.py:432,</span> in <span class="ni">writable_project</span><span class="nt">(wrapped, instance, args, kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">429</span> <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
<span class="g g-Whitespace">    </span><span class="mi">430</span> <span class="k">def</span> <span class="nf">writable_project</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">431</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`writable_project` is obsolete and does nothing&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">432</span>     <span class="k">return</span> <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/backends/base.py:519,</span> in <span class="ni">SQLiteBackend.write</span><span class="nt">(self, data, process)</span>
<span class="g g-Whitespace">    </span><span class="mi">517</span> <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">518</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">519</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_efficient_write_many_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">520</span>     <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">521</span>         <span class="c1"># Purge all data from database, then reraise</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span>         <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/backends/base.py:455,</span> in <span class="ni">SQLiteBackend._efficient_write_many_data</span><span class="nt">(self, data, indices)</span>
<span class="g g-Whitespace">    </span><span class="mi">453</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">454</span>     <span class="n">sqlite3_lci_db</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">455</span>     <span class="bp">self</span><span class="o">.</span><span class="n">delete_data</span><span class="p">(</span><span class="n">keep_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>     <span class="n">exchanges</span><span class="p">,</span> <span class="n">activities</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span>     <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm_wrapper</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;is_test&quot;</span><span class="p">))):</span>

<span class="ne">AttributeError</span>: &#39;SQLiteBackend&#39; object has no attribute &#39;delete_data&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bd</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Databases dictionary with 2 object(s):
	biosphere3
	ecoinvent-391-cutoff
</pre></div>
</div>
</div>
</div>
<p>The function apply_strategies()</p>
<p>The function statistics() will</p>
<p>We will then need to write the database to disk, using the write_database() function.</p>
<p>##NEED TO GET EXPLANATIONS FOR STATISTICS AND APPLYING STRATEGIES ##</p>
<p>In some cases, you may encounter and issue with unlinked exchanges. If you have this issue, run the cell below and then re-run the cell that imports, applies strategies, and writes the database.</p>
<p>In some cases, we may get an error related to “unlinked exchanges”. This is because there are some biosphere flows used in ecoinvent that do not exist in the BW25 biosphere3 database (and, consequently, in our LCIA methods). The best we can do is to import these unlinked flows into another biosphere database. If these flows are important to you, you should do further matching or modify the relevant LCIA methods to include them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Should you have a problem with &quot;unlinked exchanges&quot;, run this cell and then re-run the cell above.</span>
<span class="c1"># Else, skip.</span>

<span class="c1">#ei_importer.add_unlinked_flows_to_biosphere_database() </span>
</pre></div>
</div>
</div>
</div>
<p><a id='section22b'></a></p>
<h3 style="color:red;"> ### 2.2.b Importing Agribalyse database </p><p><a id='section22c'></a></p>
<h3 style="color:red;"> ### 2.2.c Importing FORWAST database </p><p><a id='section22'></a></p>
</section>
</section>
<section id="database-selection-and-a-first-look-at-activities">
<h2>2.3 Database selection and a first look at activities<a class="headerlink" href="#database-selection-and-a-first-look-at-activities" title="Permalink to this heading">#</a></h2>
<p>If our database of choice is already included, then we just make use of it directly. For convenience, we need to assign a variable to it so that the database can be worked with more easily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eidb</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">ei_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also check up on the type and length of our imported database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The imported ecoinvent database is of type </span><span class="si">{}</span><span class="s2"> and has a length of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">eidb</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">eidb</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The imported ecoinvent database is of type &lt;class &#39;bw2data.backends.base.SQLiteBackend&#39;&gt; and has a length of 0.
</pre></div>
</div>
</div>
</div>
<p>And we can even visualise our technospheres:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eidb</span><span class="o">.</span><span class="n">graph_technosphere</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/bolowich/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/backends/base.py:386: UserWarning: This database is empty
  warnings.warn(&quot;This database is empty&quot;)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">eidb</span><span class="o">.</span><span class="n">graph_technosphere</span><span class="p">()</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/backends/base.py:882,</span> in <span class="ni">SQLiteBackend.graph_technosphere</span><span class="nt">(self, filename, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span> <span class="kn">from</span> <span class="nn">bw2analyzer.matrix_grapher</span> <span class="kn">import</span> <span class="n">SparseMatrixGrapher</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span> <span class="kn">from</span> <span class="nn">bw2calc</span> <span class="kn">import</span> <span class="n">LCA</span>
<span class="ne">--&gt; </span><span class="mi">882</span> <span class="n">lca</span> <span class="o">=</span> <span class="n">LCA</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">random</span><span class="p">():</span> <span class="mi">1</span><span class="p">})</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span> <span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">885</span> <span class="n">smg</span> <span class="o">=</span> <span class="n">SparseMatrixGrapher</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2calc/lca.py:79,</span> in <span class="ni">LCA.__init__</span><span class="nt">(self, demand, method, weighting, normalization, data_objs, remapping_dicts, log_config, seed_override, use_arrays, use_distributions)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">if</span> <span class="n">data_objs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="bp">self</span><span class="o">.</span><span class="n">ensure_bw2data_available</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">79</span>     <span class="n">demand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">,</span> <span class="n">remapping_dicts</span> <span class="o">=</span> <span class="n">prepare_lca_inputs</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>         <span class="n">demand</span><span class="o">=</span><span class="n">demand</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>         <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span>         <span class="n">weighting</span><span class="o">=</span><span class="n">weighting</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>         <span class="n">normalization</span><span class="o">=</span><span class="n">normalization</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
<span class="g g-Whitespace">     </span><span class="mi">86</span>     <span class="bp">self</span><span class="o">.</span><span class="n">weighting</span> <span class="o">=</span> <span class="n">weighting</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/compat.py:83,</span> in <span class="ni">prepare_lca_inputs</span><span class="nt">(demand, method, weighting, normalization, demands, remapping, demand_database_last)</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[</span>
<span class="nn">     80         db_label for dct in demands for db_label, _</span> in <span class="ni">unpack</span><span class="nt">(dct)</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>     <span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span> <span class="k">elif</span> <span class="n">demand</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">83</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">db_label</span> <span class="k">for</span> <span class="n">db_label</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">unpack</span><span class="p">(</span><span class="n">demand</span><span class="p">)]</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2data/compat.py:83,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[</span>
<span class="nn">     80         db_label for dct in demands for db_label, _</span> in <span class="ni">unpack</span><span class="nt">(dct)</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span>     <span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span> <span class="k">elif</span> <span class="n">demand</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">83</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">db_label</span> <span class="k">for</span> <span class="n">db_label</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">unpack</span><span class="p">(</span><span class="n">demand</span><span class="p">)]</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="n">demand_database_names</span> <span class="o">=</span> <span class="p">[]</span>

<span class="ne">TypeError</span>: cannot unpack non-iterable NoneType object
</pre></div>
</div>
</div>
</div>
<p>Nice graphic! But it doesn’t really tell us much… Let’s have a bit of a closer look at what our database contains. We can, for instance, examine a random process of the imported ecoinvent database by doing the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_act</span> <span class="o">=</span> <span class="n">eidb</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">random_act</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To get an overview of all exchanges of the selected process, type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">random_act</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And if you want to get more information on one specific exchange of the chosen process, do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#change the numeral to check out the other exchanges (as from the list above)</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">random_act</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Sometimes it can also be helpful to have some activity characteristics at hand, for instance if you want to search a database using an activity’s code or want to get an activity’s name when only having its key…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#getting an activity&#39;s code</span>
<span class="n">random_act</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#getting an activity&#39;s name through its code</span>
<span class="n">eidb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">random_act</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#getting an activity&#39;s key</span>
<span class="n">random_act</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#getting an activity&#39;s name using its key</span>
<span class="n">bd</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="n">random_act</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='section23'></a></p>
</section>
<section id="importing-a-foreground-dataset-from-excel">
<h2>2.3 Importing a foreground dataset from Excel<a class="headerlink" href="#importing-a-foreground-dataset-from-excel" title="Permalink to this heading">#</a></h2>
<p>In addition to the import of a standard background database, we can also create a database, like a bespoke foreground. There are several file types that work when developing a foreground inventory, one of them being Excel (more on file types for foreground development <span style="color:red">HERE[need link here] </span>.</p>
<p>This works relatively smoothly, provided the Excel workbook is created correctly. Here, we import a flawless dataset, but it may be that you have a dataset that has some inconsistencies in the import. In that case, check that the units in the foreground match those in the background database (1L of diesel vs 1kg of diesel, for example), check your reference products are correct for the database you are referencing, look for spelling errors, …</p>
<p>More information on creating a foreground inventory in Excel can be found <span style="color:red">HERE[need link here] </span>.</p>
<p>If you have a foreground database with several activites that calls on data from other databases that you have created, <em>all</em> of the databases will need to be added. For example, there’s one database, “car_db” that contains a process “car” that contains processes “body”, “steering wheel” from the database “parts_db”, you need to execute this process for both of these databases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Include the path to the foreground database</span>
<span class="n">fg_db</span> <span class="o">=</span> <span class="s2">&quot;excel_importer_example.xlsx&quot;</span>

<span class="c1"># Import your LCI</span>
<span class="n">lci</span> <span class="o">=</span> <span class="n">bi</span><span class="o">.</span><span class="n">ExcelImporter</span><span class="p">(</span><span class="n">fg_db</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracted 2 worksheets in 0.01 seconds
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Once your package is imported we need to apply strategies</span>
<span class="n">lci</span><span class="o">.</span><span class="n">apply_strategies</span><span class="p">()</span>

<span class="c1"># We need to match databases - name and categories but ATTENTION! the categories in</span>
<span class="c1"># the excel file is &quot;None&quot; so we will also need to match against unit.</span>
<span class="n">lci</span><span class="o">.</span><span class="n">match_database</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;categories&quot;</span><span class="p">])</span>
<span class="n">lci</span><span class="o">.</span><span class="n">match_database</span><span class="p">(</span><span class="s2">&quot;ecoinvent-391-cutoff&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;categories&quot;</span><span class="p">])</span>
<span class="n">lci</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Applying strategy: csv_restore_tuples
Applying strategy: csv_restore_booleans
Applying strategy: csv_numerize
Applying strategy: csv_drop_unknown
Applying strategy: csv_add_missing_exchanges_section
Applying strategy: normalize_units
Applying strategy: normalize_biosphere_categories
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">MissingMigration</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Once your package is imported we need to apply strategies</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">lci</span><span class="o">.</span><span class="n">apply_strategies</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># We need to match databases - name and categories but ATTENTION! the categories in</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># the excel file is &quot;None&quot; so we will also need to match against unit.</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">lci</span><span class="o">.</span><span class="n">match_database</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;categories&quot;</span><span class="p">])</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/importers/base.py:126,</span> in <span class="ni">ImportBase.apply_strategies</span><span class="nt">(self, strategies, verbose)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span> <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_list</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">func_list</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">126</span>     <span class="bp">self</span><span class="o">.</span><span class="n">apply_strategy</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;signal&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="p">,</span> <span class="s2">&quot;emit&quot;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">128</span>         <span class="bp">self</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/importers/base.py:92,</span> in <span class="ni">ImportBase.apply_strategy</span><span class="nt">(self, strategy, verbose)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Applying strategy: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func_name</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">91</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">92</span>     <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">strategy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>     <span class="bp">self</span><span class="o">.</span><span class="n">applied_strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func_name</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span> <span class="k">except</span> <span class="n">StrategyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/strategies/biosphere.py:95,</span> in <span class="ni">normalize_biosphere_categories</span><span class="nt">(db, lcia)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="k">def</span> <span class="nf">normalize_biosphere_categories</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">lcia</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span><span class="sd">     Normalize biosphere categories to ecoinvent 3.1 standard in the given database.</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span><span class="sd">     [{&quot;categories&quot;: [&quot;new_biosphere_category&quot;]}]</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">95</span>     <span class="n">db</span> <span class="o">=</span> <span class="n">migrate_exchanges</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">migration</span><span class="o">=</span><span class="s2">&quot;biosphere-2-3-categories&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">lcia</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>         <span class="n">db</span> <span class="o">=</span> <span class="n">migrate_datasets</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">migration</span><span class="o">=</span><span class="s2">&quot;biosphere-2-3-categories&quot;</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/strategies/migrations.py:39,</span> in <span class="ni">migrate_exchanges</span><span class="nt">(db, migration)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> <span class="k">def</span> <span class="nf">migrate_exchanges</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">migration</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>     <span class="k">if</span> <span class="n">migration</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">migrations</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">39</span>         <span class="k">raise</span> <span class="n">MissingMigration</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>             <span class="s2">&quot;Migration `</span><span class="si">{}</span><span class="s2">` is missing; did you run `bw2setup()` in this project? You can also (re-)install core migrations  with `create_core_migrations()`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>                 <span class="n">migration</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>             <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>         <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>     <span class="n">migration_data</span> <span class="o">=</span> <span class="n">Migration</span><span class="p">(</span><span class="n">migration</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="n">to_dict</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">migration_data</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">],</span> <span class="n">x</span><span class="p">))</span>

<span class="ne">MissingMigration</span>: Migration `biosphere-2-3-categories` is missing; did you run `bw2setup()` in this project? You can also (re-)install core migrations  with `create_core_migrations()`
</pre></div>
</div>
</div>
</div>
<p>You can check whether the import went as expected by having a look at an Excel sheet, that includes our process data. The location of this file is given as output of the following command:</p>
<p>This is not an essential process, but good to know :)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lci</span><span class="o">.</span><span class="n">write_excel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Seems like everything went fine :)</p>
<p>If an exchange cannot be linked using the above applied strategies, because the respective input is listed multiple times in the database, you would have to link it manually. An example for such a case is <code class="docutils literal notranslate"><span class="pre">treatment</span> <span class="pre">of</span> <span class="pre">aluminium</span> <span class="pre">scrap,</span> <span class="pre">post-consumer,</span> <span class="pre">prepared</span> <span class="pre">for</span> <span class="pre">recycling,</span> <span class="pre">at</span> <span class="pre">refiner</span></code>, for which two ecoinvent (3.5 cutoff) entries exist.</p>
<p><span style="color:red">NEED TO KNOW HOW TO ADD A FG INPUT MANUALLY</span></p>
<p>Having imported the data, we also need to write it to a database to save it. This will write it to disk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the foreground (or custom Excel database) to disk.</span>
<span class="n">lci</span><span class="o">.</span><span class="n">write_database</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">44</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Write the foreground (or custom Excel database) to disk.</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">lci</span><span class="o">.</span><span class="n">write_database</span><span class="p">()</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/importers/excel.py:282,</span> in <span class="ni">ExcelImporter.write_database</span><span class="nt">(self, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Same as base ``write_database`` method, but ``activate_parameters`` is True by default.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;activate_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;activate_parameters&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">282</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExcelImporter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">write_database</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/mambaforge/envs/bw-tutos/lib/python3.11/site-packages/bw2io/importers/base_lci.py:272,</span> in <span class="ni">LCIImporter.write_database</span><span class="nt">(self, data, delete_existing, backend, activate_parameters, db_name, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span>         <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span>         <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">db_name</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">272</span>         <span class="n">db</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_database_parameters</span><span class="p">(</span><span class="n">activate_parameters</span><span class="p">,</span> <span class="n">delete_existing</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span> <span class="n">existing</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="ne">TypeError</span>: keywords must be strings
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check that your db now exists</span>
<span class="n">bd</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Databases dictionary with 2 object(s):
	biosphere3
	ecoinvent-391-cutoff
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wbi</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s2">&quot;BW2 Excel water bottle import&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">wbi</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wbp</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">wbi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">wbp</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">wbp</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">wbi</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">wbp</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<p>See whether the details of our biosphere exchange are correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">wbi</span> <span class="k">if</span> <span class="s1">&#39;water bottle production&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">ex</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;Carbon dioxide&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Final check whether really everything worked - these commands will be explained later in detail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">LCA</span><span class="p">(</span>
    <span class="p">{(</span><span class="s2">&quot;BW2 Excel water bottle import&quot;</span><span class="p">,</span> <span class="s2">&quot;WriteSomeCode_UUID_isFineButNotNecessary&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> 
    <span class="p">(</span><span class="s1">&#39;IPCC 2013&#39;</span><span class="p">,</span> <span class="s1">&#39;climate change&#39;</span><span class="p">,</span> <span class="s1">&#39;GWP 100a&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="n">lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
<span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, enough with that. Let’s delete this database (not the Excel file!) and the associated variables now:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">databases</span><span class="p">[</span><span class="n">wbi</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="c1">#or:</span>
<span class="c1">#wbi.delete()</span>
<span class="k">del</span> <span class="n">wbi</span><span class="p">,</span> <span class="n">wbp</span>
</pre></div>
</div>
</div>
</div>
<p>Alternatively, we can also deregister the database, which removes all metadata:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s1">&#39;BW2 Excel water bottle import&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">deregister</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section3'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="manual-database-creation">
<h1>3. Manual database creation<a class="headerlink" href="#manual-database-creation" title="Permalink to this heading">#</a></h1>
<p>In addition, let’s add a new database manually. There are two very similar ways of doing so, shown below. Mind that this database needs to be saved as well so that we can work with it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#One way of manually creating a database:</span>
<span class="n">db1</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s1">&#39;3D&#39;</span><span class="p">)</span>
<span class="n">db1</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">db1</span><span class="o">.</span><span class="n">write</span><span class="p">({(</span><span class="s1">&#39;3D&#39;</span><span class="p">,</span> <span class="s1">&#39;Printer&#39;</span><span class="p">):{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Printer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;exchanges&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;somewhere&#39;</span><span class="p">,</span>
    <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;in the&#39;</span><span class="p">,</span> <span class="s1">&#39;universe&#39;</span><span class="p">)</span>
<span class="p">}})</span>



<span class="c1">#Another way of manually creating a database is to have the data in a separate dictionary and then write it into an instantiated database:</span>
<span class="n">db2</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
<span class="n">example_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">):</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
        <span class="s2">&quot;exchanges&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;technosphere&quot;</span>
            <span class="p">}],</span>
        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;kilogram&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;here&#39;</span><span class="p">,</span>
        <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;very&quot;</span><span class="p">,</span> <span class="s2">&quot;interesting&quot;</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">(</span><span class="s2">&quot;example&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">):</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="s2">&quot;exchanges&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;microgram&#39;</span><span class="p">,</span>
        <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;there&#39;</span><span class="p">,</span>
        <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;quite&#39;</span><span class="p">,</span> <span class="s1">&#39;boring&#39;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="n">db2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">example_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see if our databases actually exist:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
</div>
<p>Well, seems like it. Now, let’s have a look at a random activity in our second database:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db2</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If we want to get some information on the number of exchanges in each activity contained in the database, we type in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_exchanges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">activity</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()))</span> <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">db2</span><span class="p">]</span>
<span class="n">num_exchanges</span>
</pre></div>
</div>
</div>
</div>
<p>We can also look for our activities, in this case all of them, by typing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>However, we don’t want to use these databases in the following. Therefore, we simply delete them, just like we deleted the dataset imported from an Excel file above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">databases</span><span class="p">[</span><span class="n">db1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<span class="k">del</span> <span class="n">databases</span><span class="p">[</span><span class="n">db2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#make sure that the databases got deleted</span>
<span class="n">bw</span><span class="o">.</span><span class="n">databases</span>
</pre></div>
</div>
</div>
</div>
<p>Okay, now that we have our background data (be it manually created or imported from an existing database), it’s time to model our foreground system!</p>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section4'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="lcia">
<h1>4. LCIA<a class="headerlink" href="#lcia" title="Permalink to this heading">#</a></h1>
<p>Before continuing with a simple product system example, the basics of the inventory caluclation shall be introduced. First, let’s have a look at which LCIA methods we can access:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span>

<span class="c1">#or use the built-in method</span>
<span class="c1">#bw.methods.list</span>

<span class="c1">#or the following</span>
<span class="c1">#bw.methods.items()</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, we see that there are quite a few methods that we could use for our LCA. Can we get more details on them? Sure we can! Those details are stored as values (<code class="docutils literal notranslate"><span class="pre">bw.methods.values()</span></code>), with the method names being the keys (<code class="docutils literal notranslate"><span class="pre">bw.methods.keys()</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>To access the description of only one method, type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;CML 2001&#39;</span><span class="p">,</span> <span class="s1">&#39;acidification potential&#39;</span><span class="p">,</span> <span class="s1">&#39;average European&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>As you can see, this is a nested dictionary. You can also access values within the nested one, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;ILCD 1.0.8 2016 midpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;ecosystem quality&#39;</span><span class="p">,</span> <span class="s1">&#39;marine eutrophication&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s select a set of LCIA methods to be applied in an inventory calculation, in this case the IPCC 2013 GWP100a (no LT).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CC_method</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;IPCC 2013&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;climate change&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;GWP 100a&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;no LT&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">CC_method</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define the functional unit/ reference flow; for now, this is only a random one, picked from our ecoinvent database:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select a process to be defined as functional unit</span>
<span class="n">process</span> <span class="o">=</span> <span class="n">eidb</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">process</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">functional_unit</span> <span class="o">=</span> <span class="p">{</span><span class="n">process</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can calculate the inventory!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span> <span class="o">=</span> <span class="n">LCA</span><span class="p">(</span><span class="n">functional_unit</span><span class="p">,</span><span class="n">CC_method</span><span class="p">)</span>

<span class="c1"># alternatively, you can enter both functional unit and LCIA method directly into the LCA-command:</span>
<span class="c1"># myFirstLCA_quick = bw.LCA({process:1}, (&#39;IPCC 2013&#39;, &#39;climate change&#39;, &#39;GWP 100a&#39;))</span>
</pre></div>
</div>
</div>
</div>
<p>And here we perform the actual impact calculation! Mind that this does not yield an output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="n">lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To see the actual impact as mid- or endpoint indicator (according to the impact assessment method used), we type in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p>This result is given in the unit specified by the impact assessment method.</p>
<p>You can also check which LCIA method was applied for a given result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">method</span>
</pre></div>
</div>
</div>
</div>
<p>To see what else you can do with the lca-object, press tab in the next cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Change the method</strong></p>
<p>Now let’s change the impact assessment method and experiment with two other methods, <code class="docutils literal notranslate"><span class="pre">redo_lci</span></code> and <code class="docutils literal notranslate"><span class="pre">redo_lcia</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agri_land_occ</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;agricultural land occupation&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;w/o LT&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lca</span><span class="o">.</span><span class="n">switch_method</span><span class="p">(</span><span class="n">agri_land_occ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can recalculate our LCI, including a changed demand, i.e. a new functional unit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demand</span> <span class="o">=</span> <span class="p">{</span><span class="n">process</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="n">lca</span><span class="o">.</span><span class="n">redo_lci</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
<span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p>The above command, however, has neither adopted the changed impact assessment method, nor has it recalculated the impacts. What’s more, we don’t see the change of the inventory reflected in our score - simply because it wasn’t recalculated. Only the inventory as well as the demand and supply arrays got changed. To recalculate our inventory with our newly chosen impact assessment method (and, if you like, an adjusted demand), we need to type the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demand2</span> <span class="o">=</span> <span class="p">{</span><span class="n">process</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">lca</span><span class="o">.</span><span class="n">redo_lcia</span><span class="p">(</span><span class="n">demand2</span><span class="p">)</span>
<span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Additional stuff</strong></p>
<p>Ok, enough with adjustments and recalculations. Let’s check out some matrices now:</p>
<ul class="simple">
<li><p>the technosphere matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the biosphere matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">biosphere_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">biosphere_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the characterisation matrix:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">characterization_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">characterization_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the inventory:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">inventory</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>the characterised inventory:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">characterized_inventory</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">characterized_inventory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>and the demand as well as supply arrays:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">demand_array</span> <span class="c1">#contains what we entered as final demand. Check that it only contains this demand by summing up the whole array</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">demand_array</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">supply_array</span> <span class="c1">#equals the multiplication of our inverted transaction matrix by the final demand, i.e. (Ae-1)*y</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section5'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="foreground-system">
<h1>5. Foreground system<a class="headerlink" href="#foreground-system" title="Permalink to this heading">#</a></h1>
<p>For modeling a foreground system, a new database is created that is linked to ecoinvent via exchanges. Some steps need to be considered, exemplified below for two simple product systems.</p>
<p><a id='section51'></a></p>
<section id="how-to-create-a-simple-product-system">
<h2>5.1 How to create a simple product system?<a class="headerlink" href="#how-to-create-a-simple-product-system" title="Permalink to this heading">#</a></h2>
<p>Now we want to create the product system for a fictitious aluminium waste handling process, consisting of inputs from the treatment of aluminium scrap as well as markets for transports and compressed air. For creating a product system, we need to create foreground processes that we link to background processes. For the latter, we can search in the background database. When we don’t know the exact name of an activity, we can first search for the parts of the name that we are sure about, e.g. low-voltage electricity:</p>
<p><strong>Setup of technosphere</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this search does not yield the complete list as we will see later</span>
<span class="n">eidb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;electricity, low voltage&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this search, however, does yield the complete list</span>
<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;electricity, low voltage&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From this list, we can select the target activity through a more narrow description including indexing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;electricity, low voltage&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;CA-ON&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">process</span>
</pre></div>
</div>
</div>
</div>
<p>Have a closer look at the description of the target activity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Side note: You can also find the name of an activity by its code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eidb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cfd25c57d2a355b94813229866ae9f5d&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s create and save a new activity for which we design the product system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waste_handling</span> <span class="o">=</span> <span class="n">eidb</span><span class="o">.</span><span class="n">new_activity</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Waste handling&quot;</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Include parameters</strong></p>
<p>Adding some parameters on the project level works like the following. Mind that there are also parameters on the activity and database level. The commands for handling and saving those are quite similar; for more details, look <a class="reference external" href="https://docs.brightwaylca.org/technical/bw2data.html#parameters">here</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">project_data</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">0.06</span><span class="p">,</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span>
    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}]</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">new_project_parameters</span><span class="p">(</span><span class="n">project_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># have a look at existing project parameters</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">ProjectParameter</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s make use of the entered parameters by parametrising the input amounts!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aluminium</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;treatment of aluminium scrap, post-consumer, prepared for recycling, at refiner&#39;</span> <span class="ow">and</span> <span class="s1">&#39;RER&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">aluminium</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kilogram&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">transport</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;market for transport, freight, lorry 3.5-7.5 metric ton, EURO5&#39;</span> <span class="ow">and</span> <span class="s1">&#39;RoW&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">transport</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ton kilometer&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;D*M/1000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">air</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;market for compressed air, 600 kPa gauge&#39;</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">air</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;cubic meter&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;D*M/1000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">waste_handling</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Before the parameters become valid, we also need to save them by adding them to a group. Then we need to recalculate the exchanges based on the parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">waste_handling</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can have a look at the inputs to our waste handling activity. There are two ways:</p>
<ul class="simple">
<li><p>one that quantifies the input:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Have a look at all exchanges of the selected activity</span>
<span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">waste_handling</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>and one that does not:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">waste_handling</span><span class="o">.</span><span class="n">technosphere</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Moreover, we can check on some details of our new activity:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get general information on the new activity</span>
<span class="n">act</span> <span class="o">=</span> <span class="n">eidb</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test1&#39;</span><span class="p">)</span>
<span class="n">act</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#or like that</span>
<span class="n">eidb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;waste handling&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Delete parameters and activities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete a set of parameters; does not delete the parameter from the project parameters list?!?</span>
<span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ProjectParameter</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="n">name</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#should delete the parameters but doesn&#39;t?!?</span>
<span class="n">ProjectParameter</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#remove the respective exchanges from the group; does not yet change anything about the exchanges?!?</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">remove_exchanges_from_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">waste_handling</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#should remove parameters, but does not really work</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">remove_from_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">waste_handling</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Delete the list of project data (or any other dictionary); does not affect the parametrised exchanges until they get recalculated</span>
<span class="n">project_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1">#.remove would only clear the content but leave empty instances</span>
<span class="c1">#quick check to see that it got deleted</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">project_data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete the table of existing project parameters, i.e. actually deletes the project parameters</span>
<span class="n">ProjectParameter</span><span class="o">.</span><span class="n">drop_table</span><span class="p">(</span><span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#create a new empty table of project parameters</span>
<span class="n">ProjectParameter</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ProjectParameter</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="n">name</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete all waste handling activities that were accidentally created</span>
<span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Waste handling&#39;</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]]:</span>
    <span class="n">activity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="c1">#delete individual bottle production activity</span>
<span class="c1">#waste_handling.delete</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check that the activity actually got deleted</span>
<span class="n">eidb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;waste handling&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Seems like it…</p>
<p><a id='section52'></a></p>
</section>
<section id="bottle-production">
<h2>5.2 Bottle production<a class="headerlink" href="#bottle-production" title="Permalink to this heading">#</a></h2>
<p>Okay, now that we know the basics for creating (and deleting) a simple product system, we will create another one, explore it, and perform an LCA on it. So, here’s a first short example on a simplified plastic bottle production. This process only has three inputs: electricity, transport, and polyethylene.</p>
<p><strong>Setup of the product system</strong></p>
<p>As mentioned earlier, the ‘eidb.search’ function does not give all the items that actually match the search criteria. We see this by comparing the following command with the one thereafter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#incomplete search results</span>
<span class="n">eidb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation,&#39;</span><span class="p">)</span><span class="c1">#, filter={&#39;location&#39;: &#39;CA-ON&#39;})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#complete search results</span>
<span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation,&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]:</span><span class="c1"># and &#39;CA-ON&#39; in act[&#39;location&#39;]]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#we can also sort our search results</span>
<span class="n">list_to_be_sorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation,&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="c1"># and &#39;CA-ON&#39; in act[&#39;location&#39;]]:</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">list_to_be_sorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<span class="c1">#for multiple keys, its works like this:</span>
<span class="c1">#newlist = sorted(list_to_be_sorted, key = itemgetter(&#39;name&#39;,&#39;categories&#39;))</span>
<span class="c1">#or</span>
<span class="c1">#newlist = sorted(list_to_be_sorted, key=lambda k: (k[&#39;name&#39;],k[&#39;categories&#39;]))</span>

<span class="n">newlist</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#now let&#39;s refine the search and pick one activity</span>
<span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation,&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;CA-ON&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>mind:
Activities do not have very many required fields; aside from database and code, the only other required field is name, but most activities will have a location and unit as well. If no type is specified for an activity, then the activity is assumed to be a process. Other types include product and biosphere for biosphere flows. Activity type is used to determine whether an activity should be placed in the biosphere or technosphere matrices during LCA calculations.</p>
<p>Let’s now create our <a class="reference external" href="https://docs.brightwaylca.org/intro.html#parameterized-datasets">parameterised product system</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#The following for-loop is only to guarantee that we can create a new bottle production process</span>
<span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;Bottle production&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]]:</span>
    <span class="n">activity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="c1"># activities and exchanges for simple bottle production model</span>
<span class="n">bottle_production</span> <span class="o">=</span> <span class="n">eidb</span><span class="o">.</span><span class="n">new_activity</span><span class="p">(</span><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bottle production&quot;</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;unit&quot;</span><span class="p">)</span>
<span class="c1">#bottle_production.save()</span>

<span class="n">project_data</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mf">0.06</span><span class="p">,</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span>
    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">}]</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">new_project_parameters</span><span class="p">(</span><span class="n">project_data</span><span class="p">)</span>

<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">ProjectParameter</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span>

<span class="n">electricity</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation, multi-Si, panel, mounted, label-certified&#39;</span> <span class="ow">and</span> <span class="s1">&#39;CH&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">electricity</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kilowatt hour&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;20*M/3.6&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1">#mind how the following activity is treated differently! The reason for this will be shown later</span>
<span class="n">polyethylene</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;market for polyethylene, high density, granulate&#39;</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pe</span> <span class="o">=</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">polyethylene</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kilogram&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">pe</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">transport</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;market for transport, freight, lorry 3.5-7.5 metric ton, EURO5&#39;</span> <span class="ow">and</span> <span class="s1">&#39;RER&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">transport</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ton kilometer&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;D*M/1000&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">bottle_production</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Cross-check the exchanges</strong></p>
<p>Let’s check whether everything went ok when creating our exchanges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#also this works:</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">bottle_production</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">bottle_production</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, seems like everything is fine with the bottle production activity. But what about the inputs - can we check how they are actually linked? Sure! To see the <strong>inputs</strong> of, for instance, our polyethylene input, we type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">polyethylene</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And to see the <strong>outputs</strong> of this activity, i.e. the upstream exchanges across the whole database, we type:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">polyethylene</span><span class="o">.</span><span class="n">upstream</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>… and yes, here it is. We can find our newly created exchange at the very bottom of the window!</p>
<p>Alternatively, we can also look straight for the <strong>output of a new exchange</strong> (and some other methods of the exchange). For doing so, it is important to have given a name to the exchange that you now want to examine further (as done when creating the product system).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pe</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">pe</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">pe</span><span class="o">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">pe</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">pe</span><span class="o">.</span><span class="n">uncertainty_type</span>
</pre></div>
</div>
</div>
</div>
<p>Mind that the <strong>amount equals to zero</strong> here. This might possibly be due to the fact that this amount is parametrised but was set to zero initially (or because of the parameter level, i.e. project in this case).</p>
<p><strong>Troubleshooting</strong></p>
<p>In case something went wrong during the setup of the product system, make sure to remove all parameters and the saved activities (as shown below) and rerun the window for creating the product system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Delete the list of project data (or any other dictionary); does not affect the parametrised exchanges until they get recalculated</span>
<span class="n">project_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1">#.remove would only clear the content but leave empty instances</span>
<span class="c1">#quick check to see that it got deleted</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">project_data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete the table of existing project parameters, i.e. actually deletes the project parameters</span>
<span class="n">ProjectParameter</span><span class="o">.</span><span class="n">drop_table</span><span class="p">(</span><span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#create a new empty table of project parameters</span>
<span class="n">ProjectParameter</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ProjectParameter</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
    <span class="n">name</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete all bottle production activities that were accidentally created</span>
<span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Bottle production&#39;</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]]:</span>
    <span class="n">activity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="c1">#delete individual bottle production activity</span>
<span class="c1">#waste_handling.delete</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s see whether really everthing got deleted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Definition of LCIA methods and functional unit</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">method_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;climate change&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">functional_unit</span> <span class="o">=</span> <span class="p">{</span><span class="n">bottle_production</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p><strong>LCA calculation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">LCA</span><span class="p">(</span><span class="n">functional_unit</span><span class="p">,</span><span class="n">method_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="n">lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">demand</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">method</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Elementary and product flows</strong></p>
<p>There are a few ways to examine the elementary flows of our product system which are explained below. The same goes for product flows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eidb</span><span class="o">.</span><span class="n">filepath_processed</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">your_structured_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">eidb</span><span class="o">.</span><span class="n">filepath_processed</span><span class="p">())</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">your_structured_array</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">bw</span><span class="o">.</span><span class="n">mapping</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">bio_params</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">activity_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting the key from the &quot;demand&quot; attribute:</span>
<span class="n">act_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">demand</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key</span>
<span class="c1"># Getting the column number from the activity_dict:</span>
<span class="n">col_index</span> <span class="o">=</span> <span class="n">lca</span><span class="o">.</span><span class="n">activity_dict</span><span class="p">[</span><span class="n">act_key</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The column index for activity </span><span class="si">{}</span><span class="s2"> is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act_key</span><span class="p">,</span> <span class="n">col_index</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#have the numbering, i.e. the value, in the beginning</span>
<span class="n">myFirstLCA_rev_activity_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lca</span><span class="o">.</span><span class="n">activity_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">myFirstLCA_rev_activity_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca_rev_act_dict</span><span class="p">,</span> <span class="n">lca_rev_product_dict</span><span class="p">,</span> <span class="n">lca_rev_bio_dict</span> <span class="o">=</span> <span class="n">lca</span><span class="o">.</span><span class="n">reverse_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As done earlier for another product system, let’s check out the technosphere:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bw2analyzer.matrix_grapher</span> <span class="kn">import</span> <span class="n">SparseMatrixGrapher</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SparseMatrixGrapher</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">biosphere_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SparseMatrixGrapher</span><span class="p">(</span><span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">ordered_graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If you’re now wondering that this looks very similar to the result of the command <code class="docutils literal notranslate"><span class="pre">eidb.graph_technosphere()</span></code>, then you’re right. The only difference is that our foreground system is now included.</p>
<p>Before being able to get deeper insights, we need to prepare a few variables, all based on the column index, which we get like that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;As a reminder, the column index for  </span><span class="si">{}</span><span class="s2"> is  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act_key</span><span class="p">,</span> <span class="n">col_index</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The column is given in <em>compressed sparse row</em> format. We can see that by doing as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myColumn</span> <span class="o">=</span> <span class="n">lca</span><span class="o">.</span><span class="n">technosphere_matrix</span><span class="p">[:,</span> <span class="n">col_index</span><span class="p">]</span>
<span class="n">myColumn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">myColumn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s switch from the <em>compressed sparse row</em> format to the <em>coordinate</em> format. With that we can examine our columns a bit further :) And, interestingly, the print-outs of our columns look exactly the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myColumnCOO</span> <span class="o">=</span> <span class="n">myColumn</span><span class="o">.</span><span class="n">tocoo</span><span class="p">()</span>
<span class="n">myColumnCOO</span>
</pre></div>
</div>
</div>
</div>
<p>The output is unchanged for that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">myColumnCOO</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myColumnCOO</span><span class="o">.</span><span class="n">row</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look again at the identifiers of our foreground activities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">lca_rev_product_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">myColumnCOO</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Through these identifiers we can also get the names of our activities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names_of_my_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">bw</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="n">lca_rev_product_dict</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">myColumnCOO</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
<span class="n">names_of_my_inputs</span>
</pre></div>
</div>
</div>
</div>
<p>And those names can of course be linked to the actual amounts (which then looks much nicer in a table than above, only with the keys).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First create a dict with the information I want:</span>
<span class="n">myColumnAsDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names_of_my_inputs</span><span class="p">,</span><span class="n">myColumnCOO</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="c1"># Create Pandas Series from dict</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">myColumnAsDict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;A series with information on exchanges in my foreground process&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>An alternative way to generate such a table is as follows, not depending on all the column-preparation…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">bw</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">input</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span><span class="n">exc</span><span class="o">.</span><span class="n">amount</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">technosphere</span><span class="p">()},</span> 
          <span class="n">name</span><span class="o">=</span><span class="s2">&quot;alternative way to generate exchanges&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Which, to be honest, does not give more information than the command we already used a couple of times (the data is simply presented in a different way):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section6'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="manipulating-an-exchange">
<h1>6. Manipulating an exchange<a class="headerlink" href="#manipulating-an-exchange" title="Permalink to this heading">#</a></h1>
<p>In the following, we want to manipulate the electricity exchange. This we want to do by not only changing the amount, but by manipulating the underlying formula.</p>
<p><a id='section61'></a></p>
<section id="copying-and-deleting-activities">
<h2>6.1 Copying and deleting activities<a class="headerlink" href="#copying-and-deleting-activities" title="Permalink to this heading">#</a></h2>
<p>First, let’s copy our bottle production product system!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span> <span class="o">=</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To see whether it really got copied, let’s have a look at the exchanges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, seems like it worked.</p>
<p>You can delete the entire technosphere of an activity like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">technosphere</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If you even want to delete the activity itself, you can do it this way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Check whether the activity is still in the database:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span> <span class="ow">in</span> <span class="n">eidb</span>
</pre></div>
</div>
</div>
</div>
<p>But now let’s get our copy back and start working with it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span> <span class="o">=</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a id='section62'></a></p>
</section>
<section id="first-attempts-at-manipulating-an-exchange-s-keys-values">
<h2>6.2 First attempts at manipulating an exchange’s keys/values<a class="headerlink" href="#first-attempts-at-manipulating-an-exchange-s-keys-values" title="Permalink to this heading">#</a></h2>
<p>First a short reminder what an exchange of our activity looks like. Let’s for example take the first exchange, which is electricity. There are different ways of getting (almost) the same information:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>And quite obviously the output of this exchange is our bottle production…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at the formula of our exchange of interest - there’s again two ways of doing so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;formula&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see if we can manipulate this formula or the exchange in general:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#add another key with value</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;value&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#change the formula and by that the amount of our exchange</span>
<span class="c1">#[exc for exc in bottle_production_copy.exchanges()][0].update({&#39;formula&#39;: &#39;40*M/3.6&#39;})</span>
<span class="nb">list</span><span class="p">(</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;formula&#39;</span><span class="p">:</span> <span class="s1">&#39;40*M/3.6&#39;</span><span class="p">})</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;formula&#39;</span><span class="p">:</span> <span class="s1">&#39;40*M/3.6&#39;</span><span class="p">}))</span>
<span class="n">example</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>example.update? #no the update command is used differently.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bottle_production_copy.substitution? #no, the substitution command is used for something else.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#change the formula and by that the amount of our exchange</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;40*M/3.6&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#see if the formula in the respective exchange changed</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Ok, so we see that nothing of this really works. Maybe we’ll still find a solution for doing so. Actually we are super close, jsut a tiny part needs to be changed. But for now, let’s try to substitute an exchange first.</p>
<p><a id='section63'></a></p>
</section>
<section id="substituting-an-exchange">
<h2>6.3 Substituting an exchange<a class="headerlink" href="#substituting-an-exchange" title="Permalink to this heading">#</a></h2>
<p>So, let’s first delete our activity and then recreate it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete individual bottle production activity</span>
<span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#delete all bottle production activities that were accidentally created</span>
<span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Bottle production copy&#39;</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]]:</span>
    <span class="n">activity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span> <span class="o">=</span> <span class="n">bottle_production</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bottle production copy&quot;</span><span class="p">)</span>
<span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Check whether the copy was actually created and saved:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eidb</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;Bottle production&#39;</span><span class="p">)</span><span class="c1">#, filter={&#39;code&#39;: &#39;test2&#39;})</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look at the exchanges of our production system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Once again, let’s see the details of our exchange of interest, i.e. electricity:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Reminder: We can also see all upstream exchanges of our activity of interest, i.e. electricity production:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">electricity</span><span class="o">.</span><span class="n">upstream</span><span class="p">()]</span>

<span class="c1">#same as:</span>
<span class="c1">#for exc in electricity.upstream():</span>
<span class="c1">#    print(exc)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s delete an exchange either from the upstream or the downstream perspective:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#downstream</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#upstream</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">electricity</span><span class="o">.</span><span class="n">upstream</span><span class="p">()][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we add a new exchange as replacement for our deleted one. This action has to be validated by adding the exchange to the group so that the amount (calculated through a formula) is correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this is our replacement for the original electricity input</span>
<span class="n">el_subst</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation, multi-Si, panel, mounted, label-certified&#39;</span> <span class="ow">and</span> <span class="s1">&#39;CH&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">el_subst</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kilowatt hour&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;40*M/3.6&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">bottle_production_copy</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s check our exchanges and whether we got what we wanted!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Yesss!!! Now, a more in-detail look at our exchange of interest (especially regarding the formula and the amount):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a id='section64'></a></p>
</section>
<section id="successfully-manipulating-an-exchange">
<h2>6.4 Successfully manipulating an exchange<a class="headerlink" href="#successfully-manipulating-an-exchange" title="Permalink to this heading">#</a></h2>
<p>Now let’s finally manipulate a key,value pair of an exchange. There are two ways for doing so, depending on whether you want to assign a name to your exchange. <strong>Alternative A</strong> is the long version, <strong>alternative B</strong> the short one.</p>
<ul class="simple">
<li><p><strong>Alternative A</strong></p></li>
</ul>
<p>Here, we want to first add another exchange to our production system, assign a variable to it, and then change its amount through an adjustment of its formula.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#add another electricity source to our bottle production system</span>
<span class="n">el_extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;electricity production, photovoltaic, 3kWp slanted-roof installation, single-Si, panel, mounted, label-certified&#39;</span> <span class="ow">and</span> <span class="s1">&#39;CH&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">el_ext</span> <span class="o">=</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">new_exchange</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">el_extra</span><span class="o">.</span><span class="n">key</span><span class="p">,</span><span class="n">amount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kilowatt hour&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;technosphere&#39;</span><span class="p">,</span> <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;10*M/3.6&#39;</span><span class="p">)</span>
<span class="n">el_ext</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">bottle_production_copy</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check our exchanges</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#have a look at the created exchange</span>
<span class="n">el_ext</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s change the amount of this exchange through an adjustment of the formula</span>

<span class="c1">#btw: for getting a subset of the exchange-dictionary, you can type (to get the formula):</span>
<span class="c1">#wanted_key = [&#39;formula&#39;]</span>
<span class="c1">#formula = dict((k, el_ext[k]) for k in wanted_key if k in el_ext)</span>

<span class="n">el_ext</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;20*M/3.6&#39;</span>

<span class="n">el_ext</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">bottle_production_copy</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check whether it worked and got adopted in the product system</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Great! It worked.</p>
<ul class="simple">
<li><p><strong>Alternative B</strong></p></li>
</ul>
<p>A quicker way for changing the formula of an exchange is to do the following. This also allows to manipulate exchanges that have no name (as compared to <code class="docutils literal notranslate"><span class="pre">el_ext</span></code> in the above example); you just need to give an intermediate name to the respective exchange.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el_exc</span><span class="o">=</span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">el_exc</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;30*M/3.6&#39;</span>
<span class="n">el_exc</span>

<span class="n">el_exc</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">bottle_production</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">parameters</span><span class="o">.</span><span class="n">add_exchanges_to_group</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">,</span> <span class="n">bottle_production_copy</span><span class="p">)</span>
<span class="n">ActivityParameter</span><span class="o">.</span><span class="n">recalculate_exchanges</span><span class="p">(</span><span class="s2">&quot;again another group&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s see whether our change got adopted in the exchange-dictionary</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check whether it is also included in the product system</span>
<span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<p>Yeah, awesome! Now we know how to do that.</p>
<p><strong>Troubleshooting</strong></p>
<p>If anything went wrong when copying or manipulating an activity, you can do the following things and restart - but if there’s no error message anywhere, don’t execute these following commands, because we will use our bottle production systems later again:</p>
<ul class="simple">
<li><p>Only delete a selected exchange (via two ways) - be sure to index correctly, otherwise you may have to reinstantiate your database:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">bottle_production_copy</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">electricity</span><span class="o">.</span><span class="n">upstream</span><span class="p">()][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Delete all exchanges that you copied accidentally:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;Bottle production copy&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;GLO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]]:</span>
    <span class="n">act</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section7'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="basic-contribution-analysis">
<h1>7. Basic contribution analysis<a class="headerlink" href="#basic-contribution-analysis" title="Permalink to this heading">#</a></h1>
<p>Based on the bottle production product system: Let’s have a bit of a closer look at the inventory and the contributions of individual exchanges/activities!</p>
<p>But before that, we recalculate our inventory:</p>
<p><a id='section71'></a></p>
<section id="recalculation-of-the-inventory">
<h2>7.1 Recalculation of the inventory<a class="headerlink" href="#recalculation-of-the-inventory" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#these are our method and functional unit, same as above in section 5.</span>
<span class="n">method_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;climate change&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">functional_unit</span> <span class="o">=</span> <span class="p">{</span><span class="n">bottle_production</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">LCA</span><span class="p">(</span><span class="n">functional_unit</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="n">lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">demand</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">method</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> process accounts for </span><span class="si">{:f}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">list</span><span class="p">(</span><span class="n">functional_unit</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
    <span class="n">lca</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
    <span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)</span>
    <span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>And now over to the contribution analysis. Let’s find the most damaging activities and biosphere flows.</p>
<p><a id='section72'></a></p>
</section>
<section id="id1">
<h2>7.2 Basic contribution analysis<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bw2analyzer</span> <span class="k">as</span> <span class="nn">bwa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ca</span> <span class="o">=</span> <span class="n">bwa</span><span class="o">.</span><span class="n">ContributionAnalysis</span><span class="p">()</span>
<span class="n">ca</span><span class="o">.</span><span class="n">annotated_top_processes</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#returns a list of tuples: (lca score, supply amount, activity name)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also set a limit below one, which will filter by fraction of impact instead of number of activities; we can also return activity keys instead of names.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#change &quot;False&quot; to &quot;True&quot; and this command will give a similar result as the following one, only that we set a limit here</span>
<span class="n">ca</span><span class="o">.</span><span class="n">annotated_top_processes</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;percent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Another way of listing the most contributing activities is this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">top_activities</span><span class="p">()</span> <span class="c1">#this command essentially relies on the annotated_top_process command from above. Hence, the output is given as (lca score, supply amount, activity name)</span>
</pre></div>
</div>
</div>
</div>
<p>And of course we can do the same for elementary flows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ca</span><span class="o">.</span><span class="n">annotated_top_emissions</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;percent&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#or like that</span>
<span class="n">lca</span><span class="o">.</span><span class="n">top_emissions</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that you can use the bw2analyzer.ContributionAnalysis method for analysing your results further, for instance through a Hinton matrix - see for yourself:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ca</span><span class="o">.</span><span class="n">hinton_matrix</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='section73'></a></p>
</section>
<section id="top-emissions-and-processes-by-name">
<h2>7.3 Top emissions and processes by name<a class="headerlink" href="#top-emissions-and-processes-by-name" title="Permalink to this heading">#</a></h2>
<p>In addition to the basic contribution analysis, we can also look at individual activities (columns) or flows (rows).</p>
<p>What if we want to group names together, i.e. to get the total impact for all “phosphates”? There isn’t a built-in function for this, but it is relatively easy to do. Let’s start with creating different lists:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="c1">#get the keys for each biosphere flow of the same name</span>
<span class="n">all_unique_names_and_their_keys</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s2">&quot;biosphere3&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">lca</span><span class="o">.</span><span class="n">biosphere_dict</span><span class="p">:</span>
        <span class="n">all_unique_names_and_their_keys</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
    
<span class="n">all_unique_names_and_their_keys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the rows for all biosphere flows of the same name</span>
<span class="n">all_unique_names_and_their_rows</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="p">[</span><span class="n">lca</span><span class="o">.</span><span class="n">biosphere_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> 
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">all_unique_names_and_their_keys</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">all_unique_names_and_their_rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the scores for all biosphere flows of the same name</span>
<span class="n">all_unique_names_and_their_scores</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="p">[</span><span class="n">lca</span><span class="o">.</span><span class="n">characterized_inventory</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">all_unique_names_and_their_rows</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">all_unique_names_and_their_scores</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s sort this list by the score and only display the first 10 results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the first 10 scores of the most contributing biosphere flows</span>
<span class="n">sorted_scores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
    <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">all_unique_names_and_their_scores</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
    <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">sorted_scores</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We can also encapsulate all this functionality in a single function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">top_emissions_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">biosphere_database</span><span class="o">=</span><span class="s1">&#39;biosphere3&#39;</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s2">&quot;biosphere3&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">lca</span><span class="o">.</span><span class="n">biosphere_dict</span><span class="p">:</span>
            <span class="n">names</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">lca</span><span class="o">.</span><span class="n">characterized_inventory</span><span class="p">[</span><span class="n">lca</span><span class="o">.</span><span class="n">biosphere_dict</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
        <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_emissions_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that this function also groups emissions according to their type, e.g. all fossil carbon dioxide emissions are summed to “Carbon dioxide, fossil”, as compared to the command in the top <code class="docutils literal notranslate"><span class="pre">ca.annotated_top_emissions</span></code>.</p>
<p>Possibly we can do the same for the technosphere flows with only slight adaptations to the above function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">top_processes_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">,</span> <span class="n">technosphere_database</span><span class="o">=</span><span class="s1">&#39;ecoinvent 3.5_cutoff_ecoSpold02&#39;</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">eidb</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">lca</span><span class="o">.</span><span class="n">activity_dict</span><span class="p">:</span>
            <span class="n">names</span><span class="p">[</span><span class="n">flow</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">lca</span><span class="o">.</span><span class="n">characterized_inventory</span><span class="p">[:,</span> <span class="n">lca</span><span class="o">.</span><span class="n">activity_dict</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">key</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> 
        <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_processes_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s check whether both the top_processes_by_name and the top_emissions_by_name equal our lca.score:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">top_processes_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">)]</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">top_emissions_by_name</span><span class="p">(</span><span class="n">lca</span><span class="p">)]</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lca</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<p>Well, I guess we can say that is close enough, as these tiny deviations may be due to some rounding errors.</p>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section8'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="multi-lca">
<h1>8. Multi-LCA<a class="headerlink" href="#multi-lca" title="Permalink to this heading">#</a></h1>
<p>To speed up comparative LCA, i.e. to compare multiple product alternatives (possibly across multiple impact categories), we can use the M-LCA functionality.</p>
<p><a id='section81'></a></p>
<section id="manually-comparing-products">
<h2>8.1 Manually comparing products<a class="headerlink" href="#manually-comparing-products" title="Permalink to this heading">#</a></h2>
<p>The original code for such a comparative static LCA can be found <a class="reference external" href="https://nbviewer.jupyter.org/github/PascalLesage/Shared-BW2-notebooks/blob/master/Comparative%20static%20LCA%20in%20Brightway2.ipynb">here</a>. Here, we want to look at <strong>bananas instead of dairy</strong>. So let’s see which activities we have in ecoinvent:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bananas_unsorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;banana&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
<span class="n">bananas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bananas_unsorted</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
<span class="n">bananas</span>
</pre></div>
</div>
</div>
</div>
<p>Of these activities, we now select the banana production processes for Colombia, Costa Rica, and India, and we select three impact methods on climate change, land use, and water stress.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banana_CO</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;banana&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;CO&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">banana_CR</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;banana&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;CR&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">banana_IN</span> <span class="o">=</span> <span class="p">[</span><span class="n">act</span> <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">eidb</span> <span class="k">if</span> <span class="s1">&#39;banana&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;IN&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">inventory</span> <span class="o">=</span> <span class="p">[</span><span class="n">banana_CO</span><span class="p">,</span> <span class="n">banana_CR</span><span class="p">,</span> <span class="n">banana_IN</span><span class="p">]</span>

<span class="n">methods</span> <span class="o">=</span> <span class="p">[[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;climate change&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;agricultural land occupation&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;w/o LT&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">][</span><span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;water depletion&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;w/o LT&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;V1.13&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s compare</span><span class="se">\n</span><span class="si">{}</span><span class="s2">,</span><span class="se">\n</span><span class="si">{}</span><span class="s2">, and</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">banana_CO</span><span class="p">,</span> <span class="n">banana_CR</span><span class="p">,</span> <span class="n">banana_IN</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">banana</span> <span class="ow">in</span> <span class="n">inventory</span><span class="p">:</span>
    <span class="n">lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">LCA</span><span class="p">({</span><span class="n">banana</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
    <span class="n">lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="n">lca</span><span class="o">.</span><span class="n">switch_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">banana</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">banana</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">],</span> <span class="n">method</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">lca</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)))</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<p>We should probably present these results in a nicer form. Let’s use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> for that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="s2">&quot;Method&quot;</span><span class="p">,</span> <span class="s2">&quot;Score&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">])</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Method&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">],</span> <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;Score&quot;</span><span class="p">)</span>
<span class="n">results_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>We can also normalise these results, which may help to get a better overview:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NormResults_df</span> <span class="o">=</span> <span class="n">results_df</span> <span class="o">/</span> <span class="n">results_df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">NormResults_df</span>
</pre></div>
</div>
</div>
</div>
<p>Sidenote: We can certainly run this kind of comparative LCA with our own product systems, e.g. the bottle production from above. We would just have to select the respective reference flow…</p>
<p><a id='section82'></a></p>
</section>
<section id="calculation-setups">
<h2>8.2 Calculation setups<a class="headerlink" href="#calculation-setups" title="Permalink to this heading">#</a></h2>
<p>A faster way of running comparative LCAs is through calculation setups. So, let’s get familiar with them! This can be done best by just employing random activities as funcitonal units and selecting the LCIA methods which can be applied to the present biosphere flows (only a subset of these ones). Due to computation time, we decide to use the FORWAST database instead of ecoinvent - although this certainly works, too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the functional units and LCIA methods; taken from example notebook</span>
<span class="n">functional_units</span> <span class="o">=</span> <span class="p">[{</span><span class="n">fw</span><span class="o">.</span><span class="n">random</span><span class="p">():</span> <span class="mi">1</span><span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="n">all_forwast_flows</span> <span class="o">=</span> <span class="p">{</span><span class="n">exc</span><span class="o">.</span><span class="n">input</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">fw</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">biosphere</span><span class="p">()}</span>
<span class="n">suitable_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> 
                    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> 
                    <span class="k">if</span> <span class="p">{</span><span class="n">cf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cf</span> <span class="ow">in</span> <span class="n">Method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()}</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">all_forwast_flows</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can use </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> LCIA methods&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">suitable_methods</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bw</span><span class="o">.</span><span class="n">methods</span><span class="p">)))</span>
<span class="n">chosen_methods</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">suitable_methods</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">functional_units</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chosen_methods</span>
</pre></div>
</div>
</div>
</div>
<p>Now we come to the actual calculation setup which gets defined through our functional units and the chosen LCIA methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_calculation_setup</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inv&#39;</span><span class="p">:</span> <span class="n">functional_units</span><span class="p">,</span> <span class="s1">&#39;ia&#39;</span><span class="p">:</span> <span class="n">chosen_methods</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calculation_setups</span><span class="p">[</span><span class="s1">&#39;set of calculation setups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_calculation_setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlca</span> <span class="o">=</span> <span class="n">MultiLCA</span><span class="p">(</span><span class="s1">&#39;set of calculation setups&#39;</span><span class="p">)</span>
<span class="n">mlca</span><span class="o">.</span><span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<p>Hm, does not seem to be so difficult. Therefore, let’s try it on a better chosen example.</p>
<p><a id='section83'></a></p>
</section>
<section id="mlca">
<h2>8.3 MLCA<a class="headerlink" href="#mlca" title="Permalink to this heading">#</a></h2>
<p>Let’s decide on our LCIA method selection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;land&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now a different way fo setting up our list of selected LCIA methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">land_methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;land&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">methods</span> <span class="o">=</span> <span class="n">land_methods</span> <span class="o">+</span> <span class="p">[[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;climate change&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">],</span>
          <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s1">&#39;ReCiPe&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span>  <span class="s1">&#39;Midpoint (H)&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;water depletion&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)][</span><span class="mi">0</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">methods</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And now we calculate the results for one functional unit (our banana production from above) and multiple LCIA methods:</p>
<p><strong>One functional unit, multiple impact categories</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">banana_lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">LCA</span><span class="p">({</span><span class="n">banana_CO</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">banana_lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
<span class="n">banana_lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
<span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
    <span class="n">banana_lca</span><span class="o">.</span><span class="n">switch_method</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
    <span class="n">banana_lca</span><span class="o">.</span><span class="n">lcia</span><span class="p">()</span>
    <span class="n">all_scores</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_scores</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">banana_lca</span><span class="o">.</span><span class="n">score</span>
    <span class="n">all_scores</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">Method</span><span class="p">(</span><span class="n">category</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The score is </span><span class="si">{:f}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> for impact category </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">banana_lca</span><span class="o">.</span><span class="n">score</span><span class="p">,</span> 
                                                 <span class="n">bw</span><span class="o">.</span><span class="n">Method</span><span class="p">(</span><span class="n">category</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
                                                 <span class="n">bw</span><span class="o">.</span><span class="n">Method</span><span class="p">(</span><span class="n">category</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can certainly present these results also in a nice table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">all_scores</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<p>And now let’s visualise the results only for the scores that have the same unit, i.e. in this example agricultural and urban land occupation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_m2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;square meter-year&#39;</span><span class="p">]</span>
<span class="n">df_m2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_m2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And of course we can find the relative contributions for our selected functional unit, too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banana_lca_unitProcessContribution</span> <span class="o">=</span> <span class="n">banana_lca</span><span class="o">.</span><span class="n">characterized_inventory</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A1</span>
<span class="n">banana_lca_unitProcessRelativeContribution</span> <span class="o">=</span> <span class="n">banana_lca_unitProcessContribution</span><span class="o">/</span><span class="n">banana_lca</span><span class="o">.</span><span class="n">score</span>
<span class="n">banana_lca_unitProcessRelativeContribution</span>
</pre></div>
</div>
</div>
</div>
<p>And now we calculate the results for multiple functional units and multiple LCIA methods:</p>
<p><strong>Multiple functional units, multiple impact categories</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Set up the production system</span>
<span class="n">prod_sys</span> <span class="o">=</span> <span class="p">[{</span><span class="n">banana_CO</span><span class="o">.</span><span class="n">key</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">banana_CR</span><span class="o">.</span><span class="n">key</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">banana_IN</span><span class="o">.</span><span class="n">key</span><span class="p">:</span><span class="mi">1</span><span class="p">}]</span>
<span class="n">prod_sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">calculation_setups</span><span class="p">[</span><span class="s1">&#39;multiLCA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inv&#39;</span><span class="p">:</span> <span class="n">prod_sys</span><span class="p">,</span> <span class="s1">&#39;ia&#39;</span><span class="p">:</span> <span class="n">methods</span><span class="p">}</span>
<span class="n">bw</span><span class="o">.</span><span class="n">calculation_setups</span><span class="p">[</span><span class="s1">&#39;multiLCA&#39;</span><span class="p">]</span>
<span class="n">myMultiLCA</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">MultiLCA</span><span class="p">(</span><span class="s1">&#39;multiLCA&#39;</span><span class="p">)</span>
<span class="n">myMultiLCA</span><span class="o">.</span><span class="n">results</span>

<span class="n">df_impact</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">myMultiLCA</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">methods</span><span class="p">)</span>
<span class="n">df_impact</span>
</pre></div>
</div>
</div>
</div>
<p>Just in case we cannot remember for some reason our functional units, we can easily find their definition again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myMultiLCA</span><span class="o">.</span><span class="n">func_units</span>
</pre></div>
</div>
</div>
</div>
<p>The same certainly goes for our chosen LCIA methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myMultiLCA</span><span class="o">.</span><span class="n">methods</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Continue, or back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<p><a id='section9'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="monte-carlo-simulation">
<h1>9. Monte Carlo simulation<a class="headerlink" href="#monte-carlo-simulation" title="Permalink to this heading">#</a></h1>
<p>According to British statistician George Cox “all models are wrong but some are useful” - in that light, quantifying uncertainty makes LCA results more reliable/robust. One of the easiest/ most common ways to do so is to perform a <a class="reference external" href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte Carlo simulation</a>, a random sampling technique. Before elaborating on that, we need to understand how uncertainty information is stored in Brightway:</p>
<section id="uncertainty-information-in-brightway">
<h2>Uncertainty information in Brightway<a class="headerlink" href="#uncertainty-information-in-brightway" title="Permalink to this heading">#</a></h2>
<p>Uncertainty is stored at the level of the exchanges - remember this! So, let’s have a look at a random ecoinvent exchange:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">eidb</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The <em>necessary</em> uncertainty information of an exchange is described in the following fields:</p>
<ul class="simple">
<li><p><strong>‘uncertainty type’</strong> : type of probability distribution function that the exchange follows. For example, the uncertainty type = 2 indicates a <code class="docutils literal notranslate"><span class="pre">lognormal</span></code>  distribution.</p></li>
<li><p><strong>‘loc’, ‘scale’, ‘shape’, ‘minimum’, ‘maximum’</strong>: parameters of the distribution function, which are respectively the location (mean <span class="math notranslate nohighlight">\(\mu\)</span>, mode, offset, or median), scale (e.g. standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>), and shape as well as minimum and maximum of the underlying distribution. Mind that different distribution functions require different parameters - not all parameters have to be defined for each distribution.</p></li>
</ul>
<p>Some <em>additional</em> uncertainty related information (‘scale without pedigree’, ‘pedigree’) are also there, but are not directly used in the calculation of the uncertainty. They are also specific to ecoinvent.</p>
<p>Uncertainty in Brightway is dealt with using a Python package called <code class="docutils literal notranslate"><span class="pre">stats_arrays</span></code> (see <a class="reference external" href="http://stats-arrays.readthedocs.io/en/latest/">here</a>), developed by Chris Mutel in the context of the development of Brightway but applicable to any stochastic model in Python. Have a look at it to see which probability distribution functions are available. And then, let’s import this package!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stats_arrays</span>
</pre></div>
</div>
</div>
</div>
<p>Just to give a brief example of how the uncertainty information “works”, let’s have a look at the lognormal distribution. As a reminder:</p>
<ul class="simple">
<li><p>a random variable <span class="math notranslate nohighlight">\(X\)</span> is a lognormal if its natural logarithm <span class="math notranslate nohighlight">\(ln(X)\)</span> is normally distributed</p></li>
<li><p>the natural logarithm of the <em>median</em> of the lognormal distribution is equal to the median (=mean) of the underlying distribution</p></li>
</ul>
<p>Taking the deterministic amount <code class="docutils literal notranslate"><span class="pre">amount</span></code> to be the median, we should have <code class="docutils literal notranslate"><span class="pre">loc</span></code> = <code class="docutils literal notranslate"><span class="pre">ln('amount')</span></code>. Let’s do this for the first exchange of a random ecoinvent activity that has a lognormal distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#run this cell again if the output is empty</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="n">exc</span> <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="n">eidb</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">.</span><span class="n">exchanges</span><span class="p">()</span> <span class="k">if</span> <span class="n">exc</span><span class="p">[</span><span class="s1">&#39;uncertainty type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">e</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="basic-monte-carlo-simulation">
<h2>Basic Monte Carlo simulation<a class="headerlink" href="#basic-monte-carlo-simulation" title="Permalink to this heading">#</a></h2>
<p><strong>One functional unit, one impact category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#MC simulation with 10 iterations for our banana production and the IPCC GWP100a method</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">MonteCarloLCA</span><span class="p">({</span><span class="n">banana_CO</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>  <span class="p">(</span><span class="s1">&#39;IPCC 2013&#39;</span><span class="p">,</span> <span class="s1">&#39;climate change&#39;</span><span class="p">,</span> <span class="s1">&#39;GWP 100a&#39;</span><span class="p">))</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">scores</span>

<span class="c1">#or this way:</span>
<span class="c1">#for _ in range(10):</span>
<span class="c1">#    print(next(mc))</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s print the results of our MC:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Well, this doesn’t really look like anything yet. We should increase the number of iterations - which yields more robust results. Around 10,000 iterations is a good starting point. However, this takes a while, so we will just give it a try with 1000 now. See for yourself how long it would take for a higher number of iterations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#define the number of iterations</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_runs</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also <strong>run the MCs in parallel</strong> which speeds up the computation time - see the following and compare the calculation times!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can also create parallel Monte Carlo that will run simultations on multiple workers simultaneoulsy</span>
bw.ParallelMonteCarlo<span class="o">?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmc</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">ParallelMonteCarlo</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">mc</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">n_runs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">pmc</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>One functional unit, multiple impact categories</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the function for MC simulation</span>
<span class="k">def</span> <span class="nf">multiImpactMonteCarloLCA</span><span class="p">(</span><span class="n">functional_unit</span><span class="p">,</span> <span class="n">list_methods</span><span class="p">,</span> <span class="n">iterations</span><span class="p">):</span>
    <span class="c1"># Step 1</span>
    <span class="n">MC_lca</span> <span class="o">=</span> <span class="n">bw</span><span class="o">.</span><span class="n">MonteCarloLCA</span><span class="p">(</span><span class="n">functional_unit</span><span class="p">)</span>
    <span class="n">MC_lca</span><span class="o">.</span><span class="n">lci</span><span class="p">()</span>
    <span class="c1"># Step 2</span>
    <span class="n">C_matrices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Step 3</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">list_methods</span><span class="p">:</span>
        <span class="n">MC_lca</span><span class="o">.</span><span class="n">switch_method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">C_matrices</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">MC_lca</span><span class="o">.</span><span class="n">characterization_matrix</span>
    <span class="c1"># Step 4</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">list_methods</span><span class="p">),</span> <span class="n">iterations</span><span class="p">))</span>
    <span class="c1"># Step 5</span>
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">MC_lca</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">method_index</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_methods</span><span class="p">):</span>
            <span class="n">results</span><span class="p">[</span><span class="n">method_index</span><span class="p">,</span> <span class="n">iteration</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">C_matrices</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">*</span><span class="n">MC_lca</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">results</span>

<span class="c1"># define the LCIA methods, functional unit, and the number of iterations</span>
<span class="n">ILCD</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">bw</span><span class="o">.</span><span class="n">methods</span> <span class="k">if</span> <span class="s2">&quot;ILCD&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;no LT&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)]</span>
<span class="n">fu</span> <span class="o">=</span> <span class="p">{</span><span class="n">banana_CO</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># let it run!</span>
<span class="n">test_results</span> <span class="o">=</span> <span class="n">multiImpactMonteCarloLCA</span><span class="p">(</span><span class="n">fu</span><span class="p">,</span> <span class="n">ILCD</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
<span class="n">test_results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ILCD</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#we can get the plots for all 34 ILCD methods (--&gt; type: len(ILCD)) by changing the index in the brackets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you are interested in applying a <strong>sensitivity analysis</strong>, check out this <a class="reference external" href="https://github.com/PoutineAndRosti/Brightway-Seminar-2017/blob/master/Day%202%20PM/Sensitivity%20analysis%20-%20example%20with%20PAWN%20indices.ipynb">notebook</a>.</p>
<hr class="docutils" />
<p>At this point, it’s worth pointing again at the <strong><a class="reference external" href="https://github.com/LCA-ActivityBrowser/activity-browser">Activity browser</a></strong> and <strong><a class="reference external" href="https://lcopt.readthedocs.io/en/latest/">LCOPT</a></strong>. These two Brightway2-extensions serve different purposes and require different settings, so check them out if you’re curious.</p>
<hr class="docutils" />
<p>And now, last but not least, here’s our reward for finishing this notebook :)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://cdn.shopify.com/s/files/1/1869/0319/products/ART-dabbing-unicorn_color-powder-blue_1024x1024.jpg?v=1523903512&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Back to <span class="xref myst">table of contents</span>?</strong></p>
<hr class="docutils" />
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">#</a></h3>
<p>Add his part from Section 1</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "brightway-lca/jupyter-book-brightway-documentation",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="BW2_for_dummies.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installing anaconda</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Authors</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introductory-note">Introductory note</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-of-a-project">1. Setup of a project</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-creating-a-new-project">1.1.a Creating a new project</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#b-use-an-existing-project">1.1.b Use an existing project</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#database-import-setup">2. Database import/setup</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-biosphere-flows">2.1 Importing biosphere flows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-a-backend-database">2.2. Importing a backend database</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-importing-ecoinvent">2.2.a Importing ecoinvent</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#database-selection-and-a-first-look-at-activities">2.3 Database selection and a first look at activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing-a-foreground-dataset-from-excel">2.3 Importing a foreground dataset from Excel</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-database-creation">3. Manual database creation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lcia">4. LCIA</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#foreground-system">5. Foreground system</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-create-a-simple-product-system">5.1 How to create a simple product system?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bottle-production">5.2 Bottle production</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#manipulating-an-exchange">6. Manipulating an exchange</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copying-and-deleting-activities">6.1 Copying and deleting activities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-attempts-at-manipulating-an-exchange-s-keys-values">6.2 First attempts at manipulating an exchange’s keys/values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#substituting-an-exchange">6.3 Substituting an exchange</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#successfully-manipulating-an-exchange">6.4 Successfully manipulating an exchange</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-contribution-analysis">7. Basic contribution analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recalculation-of-the-inventory">7.1 Recalculation of the inventory</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">7.2 Basic contribution analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#top-emissions-and-processes-by-name">7.3 Top emissions and processes by name</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-lca">8. Multi-LCA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manually-comparing-products">8.1 Manually comparing products</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-setups">8.2 Calculation setups</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlca">8.3 MLCA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation">9. Monte Carlo simulation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-information-in-brightway">Uncertainty information in Brightway</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-monte-carlo-simulation">Basic Monte Carlo simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Brightway Contributors
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>